cmake_minimum_required(VERSION 3.8 FATAL_ERROR)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# top-level project
project(csl LANGUAGES CXX)
set(PROJECT_VERSION 0.1.0)

if (${PROJECT_SOURCE_DIR} STREQUAL ${PROJECT_BINARY_DIR})
  message(FATAL_ERROR "[${CMAKE_PROJECT_NAME}] : In-source build not recommended")
endif()

## Components
## - csl::mp
add_library(csl_mp_lib INTERFACE)
target_include_directories(csl_mp_lib INTERFACE
    ${PROJECT_SOURCE_DIR}/includes #/csl/mp.hpp
)
add_library(csl::mp ALIAS csl_mp_lib)
## - csl::wf
add_library(csl_wf_lib INTERFACE)
target_include_directories(csl_wf_lib INTERFACE
    ${PROJECT_SOURCE_DIR}/includes #/csl/workflow.hpp
)
add_library(csl::wf ALIAS csl_wf_lib)

add_library(csl_lib INTERFACE)
add_dependencies(csl_lib
    csl::mp
    csl::wf
)
target_link_libraries(csl_lib INTERFACE
    csl::mp
    csl::wf
)
add_library(csl::csl ALIAS csl_lib)

# Tests
option(CSL_BUILD_ALL_TESTS "Build all tests for csl" ON)
if (CSL_BUILD_ALL_TESTS)
    enable_testing()
    # Catch2, Ctest
    add_subdirectory(${PROJECT_SOURCE_DIR}/tests/mp)
    add_subdirectory(${PROJECT_SOURCE_DIR}/tests/workflow)
endif()